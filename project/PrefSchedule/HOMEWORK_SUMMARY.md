# 4. Homework Implementation Summary

## Overview
This document summarizes the implementation of **4. Homework (2 points)** for the PrefSchedule project.

## Requirements Checklist

### ✅ Entity Classes
- [x] **Person** - Abstract base class with common fields (id, name, email)
- [x] **Student** - Extends Person, adds code (unique) and year fields
- [x] **Instructor** - Extends Person, has courses collection
- [x] **Pack** - Groups optional courses by year and semester
- [x] **Course** - Represents courses with type (COMPULSORY/OPTIONAL)

### ✅ JPA Relationships
- [x] **@OneToMany** - Instructor → Courses, Pack → Courses
- [x] **@ManyToOne** - Course → Instructor, Course → Pack
- [x] Bidirectional relationships with helper methods (addCourse, removeCourse)
- [x] Cascade operations and orphan removal configured

### ✅ Abstract Base Class
- [x] Student and Instructor both extend Person
- [x] @MappedSuperclass annotation on Person
- [x] Shared fields (id, name, email) defined once
- [x] Follows DRY (Don't Repeat Yourself) principle

### ✅ Repositories
Created JPA repositories for all entities with three types of queries:

#### 1. Derived Queries (Auto-generated by Spring Data JPA)
- `StudentRepository.findByCode(String code)` - Find student by code
- `StudentRepository.findByYear(int year)` - Find students by year
- `InstructorRepository.findByNameContainingIgnoreCase(String name)` - Search instructors
- `PackRepository.findByYearAndSemester(int year, int semester)` - Find packs
- `CourseRepository.findByType(String type)` - Find courses by type

#### 2. JPQL Queries (Custom query strings)
- `StudentRepository.findByEmailDomain(String domain)` - Find students by email domain
- `InstructorRepository.findInstructorsWithCourses()` - Find instructors who have courses
- `CourseRepository.findByInstructorNameContaining(String name)` - Search courses by instructor
- `CourseRepository.findOptionalCoursesByPack(Long packId)` - Find optional courses in pack
- `PackRepository.findByYearWithCourses(int year)` - Eager fetch courses with packs

#### 3. Transactional Modifying Queries (@Modifying + @Transactional)
- `InstructorRepository.updateEmail(Long id, String email)` - Update instructor email
- `CourseRepository.updateDescription(Long id, String description)` - Update course description

### ✅ Service Classes
Created @Service classes for all entities:
- **StudentService** - Business logic for students
- **InstructorService** - Business logic for instructors
- **PackService** - Business logic for packs
- **CourseService** - Business logic for courses

Each service:
- Uses constructor injection for repository
- Annotated with @Service and @Transactional
- Provides CRUD operations
- Exposes custom query methods

### ✅ JavaFaker Integration
- Added JavaFaker dependency (version 1.0.2)
- Used to generate realistic test data:
  - Random names for students and instructors
  - Random email addresses
  - Random course descriptions (lorem ipsum sentences)
  - Random student years (1-4)

### ✅ CRUD Operations Testing
DataLoader demonstrates complete CRUD cycle for courses:

#### CREATE
- Creates 5 students with random data
- Creates 3 instructors with random data
- Creates 2 packs (Advanced Programming, Database Systems)
- Creates 2 courses (1 compulsory, 1 optional)

#### READ
- Retrieves all courses
- Filters courses by type (COMPULSORY/OPTIONAL)
- Uses derived queries (findByYear)
- Uses JPQL queries (findInstructorsWithCourses)

#### UPDATE
- Updates course description using transactional query
- Demonstrates custom @Modifying query

#### DELETE
- Shows delete capability (commented to preserve test data)
- Demonstrates service method for deletion

## Architecture

```
┌─────────────┐
│   Person    │ (Abstract @MappedSuperclass)
│  - id       │
│  - name     │
│  - email    │
└──────┬──────┘
       │
       ├─────────────┬─────────────┐
       │             │             │
┌──────▼──────┐ ┌───▼────────┐   │
│   Student   │ │ Instructor │   │
│  - code     │ │  - courses │   │
│  - year     │ └────┬───────┘   │
└─────────────┘      │            │
                     │ @OneToMany │
                     │            │
    ┌────────────────▼────────┐   │
    │       Course            │   │
    │  - type                 │   │
    │  - code                 │   │
    │  - name                 │   │
    │  @ManyToOne instructor  │   │
    │  @ManyToOne pack        │   │
    └────────────┬────────────┘   │
                 │                │
                 │ @ManyToOne     │
                 │                │
            ┌────▼─────┐          │
            │   Pack   │          │
            │ - year   │          │
            │ - courses│          │
            └──────────┘          │
```

## Testing Results

### Build Status
```
mvn clean compile - SUCCESS
mvn test - SUCCESS (1/1 tests passed)
```

### Test Output
```
=== Creating Students ===
Created student: Mittie Hessel (Year 2)
Created student: Mrs. Alicia Lubowitz (Year 2)
...

=== Creating Instructors ===
Created instructor: Williams Grady
...

=== Creating Packs ===
Created pack: Advanced Programming Pack
...

=== CRUD Operations for Courses ===
1. CREATE - Creating new courses
   Created course: Object-Oriented Programming (ID: 1)
   Created course: Artificial Intelligence (ID: 2)

2. READ - Retrieving courses
   Total courses: 2
   Compulsory courses: 1
   Optional courses: 1

3. UPDATE - Updating course description
   Updated 1 course(s)

4. DELETE - Demonstrating delete capability
   Courses before delete: 2

=== Testing Derived Queries ===
Students in year 2: 4

=== Testing JPQL Queries ===
Instructors with courses: 1

=== Summary ===
Total students: 5
Total instructors: 3
Total packs: 2
Total courses: 2
```

### Code Quality
- ✅ Code review: All issues addressed
- ✅ Security scan (CodeQL): No vulnerabilities
- ✅ JPQL syntax: Fixed to use CONCAT for LIKE queries
- ✅ Optional return types: Consistent across repositories
- ✅ No redundant code: Removed unnecessary setId(null) calls
- ✅ Constants: Magic numbers extracted to named constants

## How to Test

### Quick Test
```bash
cd project/PrefSchedule
mvn test
```

### Run Application
```bash
cd project/PrefSchedule
mvn spring-boot:run
```

### Access H2 Console
1. Start application
2. Open: http://localhost:8080/h2-console
3. Use JDBC URL from console output
4. Run queries:
```sql
SELECT * FROM students;
SELECT * FROM instructors;
SELECT * FROM packs;
SELECT * FROM courses;

-- Test relationships
SELECT c.name, i.name as instructor, p.name as pack
FROM courses c
LEFT JOIN instructors i ON c.instructor_id = i.id
LEFT JOIN packs p ON c.pack_id = p.id;
```

## Key Features

### 1. Inheritance Strategy
- Used @MappedSuperclass for Person
- Fields are persisted in child tables (students, instructors)
- No separate person table created

### 2. Relationship Management
- Bidirectional relationships properly managed
- Helper methods maintain both sides of relationship
- Cascade operations for automatic child management
- Orphan removal for cleanup

### 3. Query Types Demonstrated
- **Derived**: Spring generates implementation from method name
- **JPQL**: Custom queries using JPA Query Language
- **Modifying**: Updates/deletes with @Modifying + @Transactional

### 4. Service Layer Pattern
- Separates business logic from data access
- Provides transaction boundaries
- Simplifies controller logic (for future REST endpoints)

### 5. Test Data Generation
- JavaFaker provides realistic data
- Randomized but deterministic
- Demonstrates all CRUD operations
- Shows query functionality

## Files Created/Modified

### New Files (11)
1. `Person.java` - Abstract base class
2. `Instructor.java` - Instructor entity
3. `Pack.java` - Pack entity
4. `Course.java` - Course entity
5. `InstructorRepository.java` - Instructor repository
6. `PackRepository.java` - Pack repository
7. `CourseRepository.java` - Course repository
8. `StudentService.java` - Student service
9. `InstructorService.java` - Instructor service
10. `PackService.java` - Pack service
11. `CourseService.java` - Course service

### Modified Files (3)
1. `pom.xml` - Added JavaFaker dependency
2. `Student.java` - Extended Person, updated builder
3. `StudentRepository.java` - Added queries
4. `DataLoader.java` - Complete rewrite with CRUD demo

## Next Steps (Future Work)

The homework is complete, but could be extended with:
- REST endpoints for all entities (section 5)
- Security layer (section 6)
- Messaging integration (section 7)
- Microservices architecture (section 8)

## Summary

All **4. Homework (2 points)** requirements have been successfully implemented:
- ✅ All entity classes created
- ✅ @OneToMany and @ManyToOne relationships
- ✅ Abstract Person class for Student/Instructor
- ✅ Repositories with 3 types of queries
- ✅ Service classes for all entities
- ✅ JavaFaker for test data
- ✅ CRUD operations demonstrated and tested

The implementation is clean, follows Spring Boot best practices, and is ready for the next phase of development.
